'use strict';var RTCMultiConnection=function(e,n){function t(n,t){function s(e){return!e.audio&&!e.video&&!e.screen&&e.data}function i(e,t){n.peersBackup[e]||(n.peersBackup[e]={userid:e,extra:{}}),n.peersBackup[e].extra=t}function r(e){if(e.remoteUserId==n.userid){if(n.peers[e.sender]&&n.peers[e.sender].extra!=e.message.extra&&(n.peers[e.sender].extra=e.extra,n.onExtraDataUpdated({userid:e.sender,extra:e.extra}),i(e.sender,e.extra)),e.message.streamSyncNeeded&&n.peers[e.sender]){var t=n.streamEvents[e.message.streamid];if(!t||!t.stream)return;var o=e.message.action;if("ended"===o||"inactive"===o||"stream-removed"===o)return n.peersBackup[t.userid]&&(t.extra=n.peersBackup[t.userid].extra),void n.onstreamended(t);var d="both"==e.message.type?null:e.message.type;return void("function"==typeof t.stream[o]&&t.stream[o](d))}if("dropPeerConnection"===e.message)return void n.deletePeer(e.sender);if(e.message.allParticipants)return-1===e.message.allParticipants.indexOf(e.sender)&&e.message.allParticipants.push(e.sender),void e.message.allParticipants.forEach(function(e){a[n.peers[e]?"renegotiatePeer":"createNewPeer"](e,{localPeerSdpConstraints:{OfferToReceiveAudio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:n.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:n.session.oneway?!!n.session.audio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:n.session.oneway?!!n.session.video||!!n.session.screen:n.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!n.session.oneway||"one-way"===n.direction,isDataOnly:s(n.session)})});if(e.message.newParticipant)return e.message.newParticipant==n.userid?void 0:n.peers[e.message.newParticipant]?void 0:void a.createNewPeer(e.message.newParticipant,e.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:n.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:n.session.oneway?!!n.session.audio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:n.session.oneway?!!n.session.video||!!n.session.screen:n.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!n.session.oneway||"one-way"===n.direction,isDataOnly:s(n.session)});if(e.message.readyForOffer&&(n.attachStreams.length&&(n.waitingForLocalMedia=!1),n.waitingForLocalMedia))return void setTimeout(function(){r(e)},1);if(e.message.newParticipationRequest&&e.sender!==n.userid){n.peers[e.sender]&&n.deletePeer(e.sender);var c={extra:e.extra||{},localPeerSdpConstraints:e.message.remotePeerSdpConstraints||{OfferToReceiveAudio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:n.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:e.message.localPeerSdpConstraints||{OfferToReceiveAudio:n.session.oneway?!!n.session.audio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:n.session.oneway?!!n.session.video||!!n.session.screen:n.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:"undefined"==typeof e.message.isOneWay?!!n.session.oneway||"one-way"===n.direction:e.message.isOneWay,isDataOnly:"undefined"==typeof e.message.isDataOnly?s(n.session):e.message.isDataOnly,dontGetRemoteStream:"undefined"==typeof e.message.isOneWay?!!n.session.oneway||"one-way"===n.direction:e.message.isOneWay,dontAttachLocalStream:!!e.message.dontGetRemoteStream,connectionDescription:e,successCallback:function(){}};return void n.onNewParticipant(e.sender,c)}return e.message.changedUUID&&n.peers[e.message.oldUUID]&&(n.peers[e.message.newUUID]=n.peers[e.message.oldUUID],delete n.peers[e.message.oldUUID]),e.message.userLeft?(a.onUserLeft(e.sender),void(!e.message.autoCloseEntireSession||n.leave())):void a.addNegotiatedMessage(e.message,e.sender)}}var o="";o+="?userid="+n.userid,o+="&sessionid="+n.sessionid,o+="&msgEvent="+n.socketMessageEvent,o+="&socketCustomEvent="+n.socketCustomEvent,o+="&autoCloseEntireSession="+!!n.autoCloseEntireSession,!0===n.session.broadcast&&(o+="&oneToMany=true"),o+="&maxParticipantsAllowed="+n.maxParticipantsAllowed,n.enableScalableBroadcast&&(o+="&enableScalableBroadcast=true",o+="&maxRelayLimitPerUser="+(n.maxRelayLimitPerUser||2)),o+="&extra="+JSON.stringify(n.extra||{}),n.socketCustomParameters&&(o+=n.socketCustomParameters);try{io.sockets={}}catch(n){}if(n.socketURL||(n.socketURL="/"),"/"!=n.socketURL.substr(n.socketURL.length-1,1))throw"\"socketURL\" MUST end with a slash.";n.enableLogs&&("/"==n.socketURL?console.info("socket.io url is: ",location.origin+"/"):console.info("socket.io url is: ",n.socketURL));try{n.socket=io(n.socketURL+o)}catch(t){n.socket=io.connect(n.socketURL+o,n.socketOptions)}var a=n.multiPeersHandler;n.socket.on("extra-data-updated",function(e,t){n.peers[e]&&(n.peers[e].extra=t,n.onExtraDataUpdated({userid:e,extra:t}),i(e,t))}),n.socket.on(n.socketMessageEvent,r);var d=!1;n.socket.resetProps=function(){d=!1},n.socket.on("connect",function(){d||(d=!0,n.enableLogs&&console.info("socket.io connection is opened."),setTimeout(function(){n.socket.emit("extra-data-updated",n.extra)},1e3),t&&t(n.socket))}),n.socket.on("disconnect",function(e){n.onSocketDisconnect(e)}),n.socket.on("error",function(e){n.onSocketError(e)}),n.socket.on("user-disconnected",function(e){e===n.userid||(n.onUserStatusChanged({userid:e,status:"offline",extra:n.peers[e]?n.peers[e].extra||{}:{}}),n.deletePeer(e))}),n.socket.on("user-connected",function(e){e===n.userid||n.onUserStatusChanged({userid:e,status:"online",extra:n.peers[e]?n.peers[e].extra||{}:{}})}),n.socket.on("closed-entire-session",function(e,t){n.leave(),n.onEntireSessionClosed({sessionid:e,userid:e,extra:t})}),n.socket.on("userid-already-taken",function(e,t){n.onUserIdAlreadyTaken(e,t)}),n.socket.on("logs",function(e){n.enableLogs&&console.debug("server-logs",e)}),n.socket.on("number-of-broadcast-viewers-updated",function(e){n.onNumberOfBroadcastViewersUpdated(e)}),n.socket.on("set-isInitiator-true",function(e){e!=n.sessionid||(n.isInitiator=!0)})}function s(e){function n(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(n){e.onFileProgress(n)},e.fbr.onBegin=function(n){e.onFileStart(n)},e.fbr.onEnd=function(n){e.onFileEnd(n)}}var t=this,s=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];e.peers={getLength:function(){var e=0;for(var n in this)-1==s.indexOf(n)&&e++;return e},selectFirst:function(){var e;for(var n in this)-1==s.indexOf(n)&&(e=this[n]);return e},getAllParticipants:function(e){var n=[];for(var t in this)-1==s.indexOf(t)&&t!=e&&n.push(t);return n},forEach:function(n){this.getAllParticipants().forEach(function(t){n(e.peers[t])})},send:function(n,s){var i=this;if(!p(n.size)&&!p(n.type)){if(e.enableFileSharing)return void t.shareFile(n,s);"string"!=typeof n&&(n=JSON.stringify(n))}if("text"!==n.type&&!(n instanceof ArrayBuffer)&&!(n instanceof DataView))return void K.send({text:n,channel:this,connection:e,remoteUserId:s});if("text"===n.type&&(n=JSON.stringify(n)),s){var r=e.peers[s];if(r)return r.channels.length?void r.channels.forEach(function(e){e.send(n)}):(e.peers[s].createDataChannel(),e.renegotiate(s),void setTimeout(function(){i.send(n,s)},3e3))}this.getAllParticipants().forEach(function(t){return i[t].channels.length?void i[t].channels.forEach(function(e){e.send(n)}):(e.peers[t].createDataChannel(),e.renegotiate(t),void setTimeout(function(){i[t].channels.forEach(function(e){e.send(n)})},3e3))})}},this.uuid=e.userid,this.getLocalConfig=function(s,i,r){return r||(r={}),{streamsToShare:r.streamsToShare||{},rtcMultiConnection:e,connectionDescription:r.connectionDescription,userid:i,localPeerSdpConstraints:r.localPeerSdpConstraints,remotePeerSdpConstraints:r.remotePeerSdpConstraints,dontGetRemoteStream:!!r.dontGetRemoteStream,dontAttachLocalStream:!!r.dontAttachLocalStream,renegotiatingPeer:!!r.renegotiatingPeer,peerRef:r.peerRef,channels:r.channels||[],onLocalSdp:function(e){t.onNegotiationNeeded(e,i)},onLocalCandidate:function(n){n=B.processCandidates(e,n),n&&t.onNegotiationNeeded(n,i)},remoteSdp:s,onDataChannelMessage:function(s){if(!e.fbr&&e.enableFileSharing&&n(),"string"==typeof s||!e.enableFileSharing)return void t.onDataChannelMessage(s,i);var r=this;return s instanceof ArrayBuffer||s instanceof DataView?void e.fbr.convertToObject(s,function(e){r.onDataChannelMessage(e)}):s.readyForNextChunk?void e.fbr.getNextChunk(s,function(n){e.peers[i].channels.forEach(function(e){e.send(n)})},i):s.chunkMissing?void e.fbr.chunkMissing(s):void e.fbr.addChunk(s,function(n){e.peers[i].peer.channel.send(n)})},onDataChannelError:function(e){t.onDataChannelError(e,i)},onDataChannelOpened:function(e){t.onDataChannelOpened(e,i)},onDataChannelClosed:function(e){t.onDataChannelClosed(e,i)},onRemoteStream:function(n){e.peers[i]&&e.peers[i].streams.push(n),t.onGettingRemoteMedia(n,i)},onRemoteStreamRemoved:function(e){t.onRemovingRemoteMedia(e,i)},onPeerStateChanged:function(e){t.onPeerStateChanged(e),"new"===e.iceConnectionState&&t.onNegotiationStarted(i,e),"connected"===e.iceConnectionState&&t.onNegotiationCompleted(i,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(t.onUserLeft(i),t.disconnectWith(i))}}},this.createNewPeer=function(n,t){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(t=t||{},!e.isInitiator||!e.session.audio||"two-way"!==e.session.audio||t.streamsToShare||(t.isOneWay=!1,t.isDataOnly=!1,t.session=e.session),!t.isOneWay&&!t.isDataOnly)return t.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:t},n);t=e.setUserPreferences(t,n);var s=this.getLocalConfig(null,n,t);e.peers[n]=new k(s)}},this.createAnsweringPeer=function(n,t,s){s=e.setUserPreferences(s||{},t);var i=this.getLocalConfig(n,t,s);e.peers[t]=new k(i)},this.renegotiatePeer=function(n,t,s){if(!e.peers[n])return void(e.enableLogs&&console.error("Peer ("+n+") does not exist. Renegotiation skipped."));t||(t={}),t.renegotiatingPeer=!0,t.peerRef=e.peers[n].peer,t.channels=e.peers[n].channels;var i=this.getLocalConfig(s,n,t);e.peers[n]=new k(i)},this.replaceTrack=function(n,t,s){if(!e.peers[t])throw"This peer ("+t+") does not exist.";var i=e.peers[t].peer;return!!i.getSenders&&"function"==typeof i.getSenders&&i.getSenders().length?void i.getSenders().forEach(function(i){s&&"video"===i.track.kind&&(e.peers[t].peer.lastVideoTrack=i.track,i.replaceTrack(n)),s||"audio"!==i.track.kind||(e.peers[t].peer.lastAudioTrack=i.track,i.replaceTrack(n))}):void(console.warn("RTPSender.replaceTrack is NOT supported."),this.renegotiatePeer(t))},this.onNegotiationNeeded=function(){},this.addNegotiatedMessage=function(n,s){if(n.type&&n.sdp)return"answer"==n.type&&e.peers[s]&&e.peers[s].addRemoteSdp(n),"offer"==n.type&&(n.renegotiatingPeer?this.renegotiatePeer(s,null,n):this.createAnsweringPeer(n,s)),void(e.enableLogs&&console.log("Remote peer's sdp:",n.sdp));if(n.candidate)return e.peers[s]&&e.peers[s].addRemoteCandidate(n),void(e.enableLogs&&console.log("Remote peer's candidate pairs:",n.candidate));if(n.enableMedia){e.session=n.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),n.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]);var i={};e.attachStreams.forEach(function(e){i[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),n.userPreferences.streamsToShare=i,t.onNegotiationNeeded({readyForOffer:!0,userPreferences:n.userPreferences},s)}n.readyForOffer&&e.onReadyForOffer(s,n.userPreferences)},this.onGettingRemoteMedia=function(){},this.onRemovingRemoteMedia=function(){},this.onGettingLocalMedia=function(){},this.onLocalMediaError=function(n,t){e.onMediaError(n,t)},this.shareFile=function(t,s){n(),e.fbr.readAsArrayBuffer(t,function(n){var t=e.getAllParticipants();s&&(t=[s]),t.forEach(function(t){e.fbr.getNextChunk(n,function(n){e.peers[t].channels.forEach(function(e){e.send(n)})},t)})},{userid:e.userid,chunkSize:"Firefox"===DetectRTC.browser.name?15000:e.chunkSize||0})};new I(e);this.onDataChannelMessage=function(n,t){(void 0).receive(JSON.parse(n),t,e.peers[t]?e.peers[t].extra:{})},this.onDataChannelClosed=function(n,t){n.userid=t,n.extra=e.peers[t]?e.peers[t].extra:{},e.onclose(n)},this.onDataChannelError=function(n,t){n.userid=t,event.extra=e.peers[t]?e.peers[t].extra:{},e.onerror(n)},this.onDataChannelOpened=function(n,t){return e.peers[t].channels.length?void(e.peers[t].channels=[n]):void(e.peers[t].channels.push(n),e.onopen({userid:t,extra:e.peers[t]?e.peers[t].extra:{},channel:n}))},this.onPeerStateChanged=function(n){e.onPeerStateChanged(n)},this.onNegotiationStarted=function(){},this.onNegotiationCompleted=function(){},this.getRemoteStreams=function(n){return n=n||e.peers.getAllParticipants()[0],e.peers[n]?e.peers[n].streams:[]}}function i(e,n,t){if("undefined"!=typeof CustomEvent){var s=new CustomEvent(n,{arguments:t,__exposedProps__:t});e.dispatchEvent(s)}}function r(e,n){if(n.stream&&v(n.stream,"audio").length){if(!e||!n)throw"Both arguments are required.";if(e.onspeaking&&e.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(n.stream,{onspeaking:function(){e.onspeaking(n)},onsilence:function(){e.onsilence(n)},onvolumechange:function(t,s){e.onvolumechange&&e.onvolumechange(merge({volume:t,threshold:s},n))}})}}}function o(e,n){n.stream&&n.stream&&n.stream.addEventListener&&(n.stream.addEventListener("mute",function(t){t=e.streamEvents[n.streamid],t.session={audio:"audio"===t.muteType,video:"video"===t.muteType},e.onmute(t)},!1),n.stream.addEventListener("unmute",function(t){t=e.streamEvents[n.streamid],t.session={audio:"audio"===t.unmuteType,video:"video"===t.unmuteType},e.onunmute(t)},!1))}function a(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),n="",t=0,s=e.length;t<s;t++)n+=e[t].toString(36);return n}return(Math.random()*new Date().getTime()).toString(36).replace(/\./g,"")}function d(e,n,t){if(!t.autoCreateMediaElement)return void n({});var s=!1;v(e,"video").length||e.isVideo||e.isScreen||(s=!0),"Firefox"===DetectRTC.browser.name&&(t.session.video||t.session.screen)&&(s=!1);var i=document.createElement(s?"audio":"video");if(i.srcObject=e,i.setAttribute("autoplay",!0),i.setAttribute("playsinline",!0),i.setAttribute("controls",!0),i.setAttribute("muted",!1),i.setAttribute("volume",1),"Firefox"===DetectRTC.browser.name){var r="ended";"oninactive"in i&&(r="inactive"),i.addEventListener(r,function(){if(currentUserMediaRequest.remove(e.idInstance),"local"===e.type){r="ended","oninactive"in e&&(r="inactive"),W.onSyncNeeded(e.streamid,r),t.attachStreams.forEach(function(n,s){e.streamid===n.streamid&&delete t.attachStreams[s]});var n=[];t.attachStreams.forEach(function(e){e&&n.push(e)}),t.attachStreams=n;var s=t.streamEvents[e.streamid];if(s)return void t.onstreamended(s);this.parentNode&&this.parentNode.removeChild(this)}},!1)}var o=i.play();if("undefined"!=typeof o){var a=!1;setTimeout(function(){a||(a=!0,n(i))},1e3),o.then(function(){a||(a=!0,n(i))}).catch(function(){a||(a=!0,n(i))})}else n(i)}function c(e,n){window.removeEventListener(e,n),window.addEventListener(e,n,!1)}function m(e){var n=[];return e.forEach(function(e){e&&n.push(e)}),n}function u(e){return!e.audio&&!e.video&&!e.screen&&e.data}function p(e){return"undefined"==typeof e}function l(e){return"string"==typeof e}function f(e,n){return!(e.session.audio&&"two-way"===e.session.audio)&&(!("Firefox"!==DetectRTC.browser.name||!1===n)||!("Chrome"!==DetectRTC.browser.name||50>DetectRTC.browser.version)&&(!(!0!==typeof n)||!!("undefined"==typeof n&&e.session.audio&&e.session.screen&&!e.session.video)&&(n=!0,!0)))}function g(e){return!("Firefox"!==DetectRTC.browser.name)||!("Chrome"!==DetectRTC.browser.name)&&{mandatory:{chromeMediaSource:e.mandatory.chromeMediaSource,chromeMediaSourceId:e.mandatory.chromeMediaSourceId}}}function v(e,n){return e&&e.getTracks?e.getTracks().filter(function(e){return e.kind===(n||"audio")}):[]}function h(){var n=!1;try{if("undefined"==typeof RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var t=new U;try{t.addTransceiver("audio"),n=!0}catch(n){}t.close()}catch(t){n=!1}return n&&S()}function S(){var n=!1;try{var t=new U({sdpSemantics:"unified-plan"});try{var e=t.getConfiguration();n=!("unified-plan"!=e.sdpSemantics)||"plan-b"!=e.sdpSemantics&&!1}catch(t){n=!1}}catch(t){n=!1}return n}function C(){if("undefined"!=typeof cordova&&"undefined"!=typeof cordova.plugins&&"undefined"!=typeof cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),"function"==typeof e.selectAudioOutput&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals()}}function b(e){var n={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo};return n}function k(e){function n(n){n.binaryType="arraybuffer",n.onmessage=function(n){e.onDataChannelMessage(n.data)},n.onopen=function(){e.onDataChannelOpened(n)},n.onerror=function(n){e.onDataChannelError(n)},n.onclose=function(n){e.onDataChannelClosed(n)},n.internalSend=n.send,n.send=function(e){"open"!==n.readyState||n.internalSend(e)},o.channel=n}function t(n){o[n](L.sdpConstraints).then(function(n){"Safari"!==DetectRTC.browser.name&&(n.sdp=s.processSdp(n.sdp)),o.setLocalDescription(n).then(function(){s.trickleIce&&(e.onLocalSdp({type:n.type,sdp:n.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:i.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:s?s.extra:{},streamsToShare:f}),s.onSettingLocalDescription(i))},function(e){s.enableLogs&&console.error("setLocalDescription error",e)})},function(e){!s.enableLogs||console.error("sdp-error",e)})}if("undefined"==typeof window.RTCPeerConnection?"undefined"==typeof mozRTCPeerConnection?"undefined"!=typeof webkitRTCPeerConnection&&(U=webkitRTCPeerConnection):U=mozRTCPeerConnection:U=window.RTCPeerConnection,A=window.RTCSessionDescription||window.mozRTCSessionDescription,D=window.RTCIceCandidate||window.mozRTCIceCandidate,N=window.MediaStreamTrack,!U)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var s=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:s.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription,this.addStream=function(e){s.addStream(e,i.userid)},this.removeStream=function(e){s.removeStream(e,i.userid)};var i=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var r={};L.sdpConstraints=b({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var o,a=!!e.renegotiatingPeer;e.remoteSdp&&(a=!!e.remoteSdp.renegotiatingPeer);var d=[];if(s.attachStreams.forEach(function(e){!e||d.push(e)}),!a){var c="all";!s.candidates.turn&&!s.candidates.relay||s.candidates.stun||s.candidates.reflexive||s.candidates.host||(c="relay");try{var m={iceServers:s.iceServers,iceTransportPolicy:s.iceTransportPolicy||c};"undefined"!=typeof s.iceCandidatePoolSize&&(m.iceCandidatePoolSize=s.iceCandidatePoolSize),"undefined"!=typeof s.bundlePolicy&&(m.bundlePolicy=s.bundlePolicy),"undefined"!=typeof s.rtcpMuxPolicy&&(m.rtcpMuxPolicy=s.rtcpMuxPolicy),!s.sdpSemantics||(m.sdpSemantics=s.sdpSemantics||"unified-plan"),s.iceServers&&s.iceServers.length||(m=null,s.optionalArgument=null),o=new U(m,s.optionalArgument)}catch(n){try{var m={iceServers:s.iceServers};o=new U(m)}catch(n){o=new U}}}else o=e.peerRef;!o.getRemoteStreams&&o.getReceivers&&(o.getRemoteStreams=function(){var e=new M;return o.getReceivers().forEach(function(n){e.addTrack(n.track)}),[e]}),!o.getLocalStreams&&o.getSenders&&(o.getLocalStreams=function(){var e=new M;return o.getSenders().forEach(function(n){e.addTrack(n.track)}),[e]}),o.onicecandidate=function(n){if(!n.candidate){if(!s.trickleIce){var t=o.localDescription;e.onLocalSdp({type:t.type,sdp:t.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:i.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:s?s.extra:{},streamsToShare:f})}return}s.trickleIce&&e.onLocalCandidate({candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex})},d.forEach(function(n){e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||e.dontAttachLocalStream||(n=s.beforeAddingStream(n,i),n&&(o.getLocalStreams().forEach(function(e){n&&e.id==n.id&&(n=null)}),n&&n.getTracks&&n.getTracks().forEach(function(e){try{o.addTrack(e,n)}catch(n){}})))}),o.oniceconnectionstatechange=o.onsignalingstatechange=function(){var n=i.extra;s.peers[i.userid]&&(n=s.peers[i.userid].extra||n),o&&(e.onPeerStateChanged({iceConnectionState:o.iceConnectionState,iceGatheringState:o.iceGatheringState,signalingState:o.signalingState,extra:n,userid:i.userid}),o&&o.iceConnectionState&&-1!==o.iceConnectionState.search(/closed|failed/gi)&&i.streams instanceof Array&&i.streams.forEach(function(e){var n=s.streamEvents[e.id]||{streamid:e.id,stream:e,type:"remote"};s.onstreamended(n)}))};var u={OfferToReceiveAudio:!!d.length,OfferToReceiveVideo:!!d.length};e.localPeerSdpConstraints&&(u=e.localPeerSdpConstraints),L.sdpConstraints=b(u);var p={};o.ontrack=function(n){if(n&&"track"===n.type){if(n.stream=n.streams[n.streams.length-1],n.stream.id||(n.stream.id=n.track.id),p[n.stream.id]&&"Safari"!==DetectRTC.browser.name)return void(n.track&&(n.track.onended=function(){o&&o.onremovestream(n)}));p[n.stream.id]=n.stream.id;var t={};e.remoteSdp&&e.remoteSdp.streamsToShare?t=e.remoteSdp.streamsToShare:e.streamsToShare&&(t=e.streamsToShare);var s=t[n.stream.id];s?(n.stream.isAudio=s.isAudio,n.stream.isVideo=s.isVideo,n.stream.isScreen=s.isScreen):(n.stream.isVideo=!!v(n.stream,"video").length,n.stream.isAudio=!n.stream.isVideo,n.stream.isScreen=!1),n.stream.streamid=n.stream.id,r[n.stream.id]=n.stream,e.onRemoteStream(n.stream),n.stream.getTracks().forEach(function(e){e.onended=function(){o&&o.onremovestream(n)}}),n.stream.onremovetrack=function(){o&&o.onremovestream(n)}}},o.onremovestream=function(n){n.stream.streamid=n.stream.id,r[n.stream.id]&&delete r[n.stream.id],e.onRemoteStreamRemoved(n.stream)},"function"!=typeof o.removeStream&&(o.removeStream=function(e){e.getTracks().forEach(function(n){o.removeTrack(n,e)})}),this.addRemoteCandidate=function(e){o.addIceCandidate(new D(e))},this.addRemoteSdp=function(e,n){n=n||function(){},"Safari"!==DetectRTC.browser.name&&(e.sdp=s.processSdp(e.sdp)),o.setRemoteDescription(new A(e)).then(n,function(t){!s.enableLogs||console.error("setRemoteDescription failed","\n",t,"\n",e.sdp),n()}).catch(function(t){!s.enableLogs||console.error("setRemoteDescription failed","\n",t,"\n",e.sdp),n()})};var l=!0;e.remoteSdp&&(l=!1),this.createDataChannel=function(){var e=o.createDataChannel("sctp",{});n(e)},!0!==s.session.data||a||(l?this.createDataChannel():o.ondatachannel=function(e){var t=e.channel;n(t)}),this.enableDisableVideoEncoding=function(e){var n;if(o.getSenders().forEach(function(e){n||"video"!==e.track.kind||(n=e)}),n&&n.getParameters){var t=n.getParameters();t.encodings[1]&&(t.encodings[1].active=!!e),t.encodings[2]&&(t.encodings[2].active=!!e),n.setParameters(t)}},e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(u=e.remoteSdp.remotePeerSdpConstraints),L.sdpConstraints=b(u),this.addRemoteSdp(e.remoteSdp,function(){t("createAnswer")})),("two-way"==s.session.audio||"two-way"==s.session.video||"two-way"==s.session.screen)&&(L.sdpConstraints=b({OfferToReceiveAudio:"two-way"==s.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==s.session.video||"two-way"==s.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var f={};o.getLocalStreams().forEach(function(e){f[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),l&&t("createOffer"),o.nativeClose=o.close,o.close=function(){if(o){try{o.nativeClose!==o.close&&o.nativeClose()}catch(n){}o=null,i.peer=null}},this.peer=o}function w(e,n){e.mandatory&&e.mandatory.chromeMediaSource?n.isScreen=!0:e.mozMediaSource||e.mediaSource?n.isScreen=!0:e.video?n.isVideo=!0:e.audio&&(n.isAudio=!0)}function y(e){function n(n,s){w(e.localMediaConstraints,n);var i="ended";"oninactive"in n&&(i="inactive"),n.addEventListener(i,function(){delete currentUserMediaRequest.streams[t],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=m(currentUserMediaRequest.queueRequests))},!1),currentUserMediaRequest.streams[t]={stream:n},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&y(currentUserMediaRequest.queueRequests.shift()),e.onGettingLocalMedia(n,s)}if(!0===currentUserMediaRequest.mutex)return void currentUserMediaRequest.queueRequests.push(e);currentUserMediaRequest.mutex=!0;var t=JSON.stringify(e.localMediaConstraints);if(currentUserMediaRequest.streams[t])n(currentUserMediaRequest.streams[t].stream,!0);else{var s=!!/BB10|BlackBerry/i.test(navigator.userAgent||"");if(s||"undefined"==typeof navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,function(e){e.streamid=e.streamid||e.id||a(),e.idInstance=t,n(e)},function(n){e.onLocalMediaError(n,e.localMediaConstraints)});if("undefined"==typeof navigator.mediaDevices){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var i,r,o=function(){},d=function(){};navigator.mediaDevices={getUserMedia:function(e){return navigator.getUserMedia(e,function(e){e(stream),i=stream},function(e){d(e),r=e}),{then:function(e){return i?void e(i):(o=e,{then:function(e){return r?void e(r):void(d=e)}})}}}}}navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||a(),e.idInstance=t,n(e)}).catch(function(n){e.onLocalMediaError(n,e.localMediaConstraints)})}}function E(e){if("PermissionDeniedError"==e){if(j="PermissionDeniedError",q)return q("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(j="desktop"),e.sourceId&&q&&q(G=e.sourceId,!0===e.canRequestAudioTrack)}function x(e){return e?"desktop"==j?e(!0):void(window.postMessage("are-you-there","*"),setTimeout(function(){"screen"==j?e(!1):e(!0)},2e3)):void 0}function T(e){if(!e)throw"\"callback\" parameter is mandatory.";return G?e(G):void(q=e,window.postMessage("get-sourceId","*"))}function R(e){if(!e)throw"\"callback\" parameter is mandatory.";return G?e(G):void(q=e,window.postMessage("audio-plus-tab","*"))}function P(e,n){if(H)return n("not-chrome");2!=arguments.length&&(n=e,e="ajhifddimkapgcifgcodmmfdlknahffk");var t=document.createElement("img");t.src="chrome-extension://"+e+"/icon.png",t.onload=function(){j="screen",window.postMessage("are-you-there","*"),setTimeout(function(){"screen"==j?n("installed-disabled"):n("installed-enabled")},2e3)},t.onerror=function(){n("not-installed")}}function O(e,n){if(H)return e(null,{mozMediaSource:"window",mediaSource:"window"});var t={mandatory:{chromeMediaSource:j,maxWidth:1920<screen.width?screen.width:1920,maxHeight:1080<screen.height?screen.height:1080},optional:[]};return"desktop"!=j||G?void("desktop"==j&&(t.mandatory.chromeMediaSourceId=G),e(null,t)):void(n?R(function(n,s){t.mandatory.chromeMediaSourceId=n,s&&(t.canRequestAudioTrack=!0),e("PermissionDeniedError"==n?n:null,t)}):T(function(n){t.mandatory.chromeMediaSourceId=n,e("PermissionDeniedError"==n?n:null,t)}))}function I(n){var t={};return{receive:function(s,i,r){var o=s.uuid;if(t[o]||(t[o]=[]),t[o].push(s.message),s.last){var a=t[o].join("");s.isobject&&(a=JSON.parse(a));var d=new Date().getTime(),c=d-s.sendingTime,m={data:a,userid:i,extra:r,latency:c};n.autoTranslateText?(m.original=m.data,n.Translator.TranslateText(m.data,function(e){m.data=e,n.onmessage(m)})):n.onmessage(m),delete t[o]}}}}(function(e){e&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},!global.console&&(global.console={}),"undefined"==typeof global.console.debug&&(global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(e.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},document.addEventListener=document.removeEventListener=e.addEventListener=e.removeEventListener=function(){},e.HTMLVideoElement=e.HTMLMediaElement=function(){}),"undefined"==typeof io&&(e.io=function(){return{on:function(e,n){n=n||function(){},"connect"===e&&n()},emit:function(e,n,t){t=t||function(){},("open-room"===e||"join-room"===e)&&t(!0,n.sessionid,null)}}}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:"",origin:"self"}),"undefined"==typeof screen&&(e.screen={width:0,height:0}),"undefined"==typeof URL&&(e.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),e.window=global)})("undefined"==typeof global?null:global),"use strict",function(){function e(){var e,n,t,s=m.appVersion,i=m.userAgent,r=m.appName,o=""+parseFloat(m.appVersion),a=parseInt(m.appVersion,10);if(g&&!v&&-1!==i.indexOf("CriOS")&&(g=!1,v=!0),l){r="Opera";try{o=m.userAgent.split("OPR/")[1].split(" ")[0],a=o.split(".")[0]}catch(n){o="0.0.0.0",a=0}}else h?(n=i.indexOf("rv:"),0<n?o=i.substring(n+3):(n=i.indexOf("MSIE"),o=i.substring(n+5)),r="IE"):v?(n=i.indexOf("Chrome"),r="Chrome",o=i.substring(n+7)):g?(n=i.indexOf("Safari"),r="Safari",o=i.substring(n+7),-1!==(n=i.indexOf("Version"))&&(o=i.substring(n+8)),-1!==m.userAgent.indexOf("Version/")&&(o=m.userAgent.split("Version/")[1].split(" ")[0])):f?(n=i.indexOf("Firefox"),r="Firefox",o=i.substring(n+8)):(e=i.lastIndexOf(" ")+1)<(n=i.lastIndexOf("/"))&&(r=i.substring(e,n),o=i.substring(n+1),r.toLowerCase()===r.toUpperCase()&&(r=m.appName));return p&&(r="Edge",o=m.userAgent.split("Edge/")[1]),-1!==(t=o.search(/[; \)]/))&&(o=o.substring(0,t)),a=parseInt(""+o,10),isNaN(a)&&(o=""+parseFloat(m.appVersion),a=parseInt(m.appVersion,10)),{fullVersion:o,version:a,name:r,isPrivateBrowsing:!1}}function n(e,n){var t=0,s=!1,i=window.setInterval(function(){e()&&(window.clearInterval(i),n(s)),50<t++&&(window.clearInterval(i),s=!0,n(s))},10)}function t(e){var n=e.toLowerCase();if(0===n.indexOf("msie")&&0===n.indexOf("trident"))return!1;var t=/(?:msie|rv:)\s?([\d\.]+)/.exec(n);return!!(t&&10<=parseInt(t[1],10))}function s(){for(var e,n="-",t=m.appVersion,s=m.userAgent,r=n,o=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],a=0;e=o[a];a++)if(e.r.test(s)){r=e.s;break}var d=n;return /Windows/.test(r)&&(/Windows (.*)/.test(r)&&(d=/Windows (.*)/.exec(r)[1]),r="Windows"),"Mac OS X"===r?/Mac OS X (10[\.\_\d]+)/.test(s)&&(d=/Mac OS X (10[\.\_\d]+)/.exec(s)[1]):"Android"===r?/Android ([\.\_\d]+)/.test(s)&&(d=/Android ([\.\_\d]+)/.exec(s)[1]):"iOS"===r?/OS (\d+)_(\d+)_?(\d+)?/.test(s)&&(d=/OS (\d+)_(\d+)_?(\d+)?/.exec(t),d=d[1]+"."+d[2]+"."+(0|d[3])):void 0,{osName:r,osVersion:d}}function i(e){e=(e||m.userAgent).toLowerCase();var n=e.match(/android\s([0-9\.]*)/);return!!n&&n[1]}function r(e,n){function t(n){if(!n)return void e();var t=x.exec(n);if(t){var s=t[1],r=n.match(E);void 0===i[s]&&e(s,r,!0),i[s]=!0}}function s(){var e=m.localDescription.sdp.split("\n");e.forEach(function(e){e&&0===e.indexOf("a=candidate:")&&t(e)})}if("undefined"!=typeof document&&"function"==typeof document.getElementById){var i={},r=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!r){var o=document.getElementById("iframe");if(!o)return;var a=o.contentWindow;r=a.RTCPeerConnection||a.mozRTCPeerConnection||a.webkitRTCPeerConnection}if(r){var d=null;"Chrome"===B.browser&&58>B.browser.version&&(d={optional:[{RtpDataChannels:!0}]});var c=svConfigs.iceServers,m=new r(c,d);if(n&&(m.addStream?m.addStream(n):m.addTrack&&n.getTracks()[0]&&m.addTrack(n.getTracks()[0],n)),m.onicecandidate=function(e){e.candidate&&e.candidate.candidate?t(e.candidate.candidate):t()},!n)try{m.createDataChannel("sctp",{})}catch(n){}B.isPromisesSupported?m.createOffer().then(function(e){m.setLocalDescription(e).then(s)}):m.createOffer(function(e){m.setLocalDescription(e,s,function(){})},function(){})}}}function o(e){if(!M)return void(e&&e());if(!m.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(m.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!m.enumerateDevices&&m.enumerateDevices&&(m.enumerateDevices=m.enumerateDevices.bind(m)),!m.enumerateDevices)return void(e&&e());R=[],P=[],O=[],I=[],U=!1,L=!1,A=!1,D=!1,V=!1;var n={};m.enumerateDevices(function(t){t.forEach(function(e){var t={};for(var s in e)try{"function"!=typeof e[s]&&(t[s]=e[s])}catch(n){}n[t.deviceId+t.label+t.kind]||("audio"===t.kind&&(t.kind="audioinput"),"video"===t.kind&&(t.kind="videoinput"),!t.deviceId&&(t.deviceId=t.id),!t.id&&(t.id=t.deviceId),t.label?("videoinput"===t.kind&&!V&&(V=!0),"audioinput"===t.kind&&!D&&(D=!0)):(t.isCustomLabel=!0,t.label="videoinput"===t.kind?"Camera "+(I.length+1):"audioinput"===t.kind?"Microphone "+(P.length+1):"audiooutput"===t.kind?"Speaker "+(O.length+1):"Please invoke getUserMedia once.","undefined"!=typeof B&&B.browser.isChrome&&46<=B.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(t.label="HTTPs is required to get label of this "+t.kind+" device.")),"audioinput"===t.kind&&(U=!0,-1===P.indexOf(t)&&P.push(t)),"audiooutput"===t.kind&&(L=!0,-1===O.indexOf(t)&&O.push(t)),"videoinput"===t.kind&&(A=!0,-1===I.indexOf(t)&&I.push(t)),R.push(t),n[t.deviceId+t.label+t.kind]=t)}),"undefined"!=typeof B&&(B.MediaDevices=R,B.hasMicrophone=U,B.hasSpeakers=L,B.hasWebcam=A,B.isWebsiteHasWebcamPermissions=V,B.isWebsiteHasMicrophonePermissions=D,B.audioInputDevices=P,B.audioOutputDevices=O,B.videoInputDevices=I),e&&e()})}var a="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",d="object"==typeof process&&"object"==typeof process.versions&&process.versions.node&&!process.browser;if(d){var c=process.versions.node.toString().replace("v","");a="Nodejs/"+c+" (NodeOS) AppleWebKit/"+c+" (KHTML, like Gecko) Nodejs/"+c+" Nodejs/"+c}(function(e){"undefined"!=typeof window||("undefined"==typeof window&&"undefined"!=typeof global?(global.navigator={userAgent:a,getUserMedia:function(){}},e.window=global):"undefined"==typeof window,"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}))})("undefined"==typeof global?window:global);var m=window.navigator;"undefined"==typeof m?m={getUserMedia:function(){},userAgent:a}:("undefined"!=typeof m.webkitGetUserMedia&&(m.getUserMedia=m.webkitGetUserMedia),"undefined"!=typeof m.mozGetUserMedia&&(m.getUserMedia=m.mozGetUserMedia));var u=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(m.userAgent||""),p=-1!==m.userAgent.indexOf("Edge")&&(!!m.msSaveOrOpenBlob||!!m.msSaveBlob),l=!!window.opera||0<=m.userAgent.indexOf(" OPR/"),f="undefined"!=typeof window.InstallTrigger,g=/^((?!chrome|android).)*safari/i.test(m.userAgent),v=!!window.chrome&&!l,h="undefined"!=typeof document&&!!document.documentMode&&!p,S={Android:function(){return m.userAgent.match(/Android/i)},BlackBerry:function(){return m.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return m.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return m.userAgent.match(/Opera Mini/i)},Windows:function(){return m.userAgent.match(/IEMobile/i)},any:function(){return S.Android()||S.BlackBerry()||S.iOS()||S.Opera()||S.Windows()},getOsName:function(){var e="Unknown OS";return S.Android()&&(e="Android"),S.BlackBerry()&&(e="BlackBerry"),S.iOS()&&(e="iOS"),S.Opera()&&(e="Opera Mini"),S.Windows()&&(e="Windows"),e}},C="Unknown OS",b="Unknown OS Version",k=s();k&&k.osName&&"-"!=k.osName?(C=k.osName,b=k.osVersion):S.any()&&(C=S.getOsName(),"Android"==C&&(b=i()));var d="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;"Unknown OS"===C&&d&&(C="Nodejs",b=process.versions.node.toString().replace("v",""));var w=!1,y=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){"undefined"==typeof document||"function"!=typeof document.createElement||(!w&&e in document.createElement("canvas")&&(w=!0),!y&&e in document.createElement("video")&&(y=!0))});var E=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,x=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,T=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/,R=[],P=[],O=[],I=[];m.mediaDevices&&m.mediaDevices.enumerateDevices&&(m.enumerateDevices=function(e){var n=m.mediaDevices.enumerateDevices();n&&n.then?m.mediaDevices.enumerateDevices().then(e).catch(function(){e([])}):e([])});var M=!1;"undefined"!=typeof N&&"getSources"in N?M=!0:m.mediaDevices&&!!m.mediaDevices.enumerateDevices&&(M=!0);var U=!1,L=!1,A=!1,D=!1,V=!1,B=window.DetectRTC||{};B.browser=e(),function(e){var s;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){s=!1},function(){s=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var i;try{i=window.indexedDB.open("test"),i.onerror=function(){return!0}}catch(n){s=!0}"undefined"==typeof s&&n(function(){return"done"===i.readyState},function(e){e||(s=!i.result)})}else if(t(window.navigator.userAgent)){s=!1;try{window.indexedDB||(s=!0)}catch(n){s=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(n){s=!0}"undefined"==typeof s&&(s=!1,window.localStorage.removeItem("test"))}}catch(n){s=!1}n(function(){return"undefined"!=typeof s},function(){e(s)})}(function(e){B.browser.isPrivateBrowsing=!!e}),B.browser["is"+B.browser.name]=!0,B.osName=C,B.osVersion=b;var F="object"==typeof process&&"object"==typeof process.versions&&process.versions["node-webkit"],W=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){W||e in window&&(W=!0)}),B.isWebRTCSupported=W,B.isORTCSupported="undefined"!=typeof RTCIceGatherer;var G=!1;if(B.browser.isChrome&&35<=B.browser.version?G=!0:B.browser.isFirefox&&34<=B.browser.version?G=!0:B.browser.isEdge&&17<=B.browser.version?G=!0:"Android"===B.osName&&B.browser.isChrome&&(G=!0),!/^(https:|chrome-extension:)$/g.test(location.protocol||"")){var q="undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g);q&&(B.browser.isChrome||B.browser.isEdge||B.browser.isOpera)?G=!1:B.browser.isFirefox&&(G=!1)}B.isScreenCapturingSupported=G;var j={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){j.isSupported||e in window&&(j.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(j.isCreateMediaStreamSourceSupported=!0))}),B.isAudioContextSupported=j.isSupported,B.isCreateMediaStreamSourceSupported=j.isCreateMediaStreamSourceSupported;var H=!1;B.browser.isChrome&&31<B.browser.version&&(H=!0),B.isRtpDataChannelsSupported=H;var z=!1;B.browser.isFirefox&&28<B.browser.version?z=!0:B.browser.isChrome&&25<B.browser.version?z=!0:B.browser.isOpera&&11<=B.browser.version&&(z=!0),B.isSctpDataChannelsSupported=z,B.isMobileDevice=u;var _=!1;m.getUserMedia?_=!0:m.mediaDevices&&m.mediaDevices.getUserMedia&&(_=!0),B.browser.isChrome&&46<=B.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(_="Requires HTTPs"),"Nodejs"===B.osName&&(_=!1),B.isGetUserMediaSupported=_;var K="";if(screen.width){var J=screen.width?screen.width:"",X=screen.height?screen.height:"";K+=""+J+" x "+X}B.displayResolution=K,B.displayAspectRatio=function(e,n){function t(e,n){return 0==n?e:t(n,e%n)}var s=t(e,n);return e/s/(n/s)}(screen.width,screen.height).toFixed(2),B.isCanvasSupportsStreamCapturing=w,B.isVideoSupportsStreamCapturing=y,"Chrome"==B.browser.name&&53<=B.browser.version&&(!B.isCanvasSupportsStreamCapturing&&(B.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),!B.isVideoSupportsStreamCapturing&&(B.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),B.DetectLocalIPAddress=function(e,n){if(B.isWebRTCSupported){var t=!0,s=!0;r(function(n){n?n.match(E)?(t=!1,e("Local: "+n,t,s)):n.match(T)?(s=!1,e("Public: "+n,t,s)):e("Public: "+n,t,s):e()},n)}},B.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,B.isWebSocketsBlocked=!B.isWebSocketsSupported,"Nodejs"===B.osName&&(B.isWebSocketsSupported=!0,B.isWebSocketsBlocked=!1),B.checkWebSocketsSupport=function(n){n=n||function(){};try{var t,s=new WebSocket("wss://echo.websocket.org:443/");s.onopen=function(){B.isWebSocketsBlocked=!1,t=new Date().getTime(),s.send("ping")},s.onmessage=function(){B.WebsocketLatency=new Date().getTime()-t+"ms",n(),s.close(),s=null},s.onerror=function(){B.isWebSocketsBlocked=!0,n()}}catch(t){B.isWebSocketsBlocked=!0,n()}},B.load=function(e){e=e||function(){},o(e)},"function"==typeof o,B.MediaDevices="undefined"==typeof R?[]:R,B.hasMicrophone=U,B.hasSpeakers=L,B.hasWebcam=A,B.isWebsiteHasWebcamPermissions=V,B.isWebsiteHasMicrophonePermissions=D,B.audioInputDevices=P,B.audioOutputDevices=O,B.videoInputDevices=I;var Y=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(Y=!0),B.isSetSinkIdSupported=Y;var Q=!1;B.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(Q=!0):B.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(Q=!0),B.isRTPSenderReplaceTracksSupported=Q;var $=!1;B.browser.isFirefox&&38<B.browser.version&&($=!0),B.isRemoteStreamProcessingSupported=$;var Z=!1;"undefined"!=typeof N&&"applyConstraints"in N.prototype&&(Z=!0),B.isApplyConstraintsSupported=Z;var ee=!1;B.browser.isFirefox&&43<=B.browser.version&&(ee=!0),B.isMultiMonitorScreenCapturingSupported=ee,B.isPromisesSupported=!!("Promise"in window),B.version="1.3.9","undefined"==typeof B&&(window.DetectRTC={});var ne=window.MediaStream;"undefined"==typeof ne&&"undefined"!=typeof webkitMediaStream&&(ne=webkitMediaStream),B.MediaStream="undefined"!=typeof ne&&"function"==typeof ne&&Object.keys(ne.prototype),B.MediaStreamTrack="undefined"!=typeof N&&Object.keys(N.prototype);var te=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;B.RTCPeerConnection="undefined"!=typeof te&&Object.keys(te.prototype),window.DetectRTC=B,"undefined"!=typeof module&&(module.exports=B),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return B})}(),"undefined"!=typeof cordova&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),window.addEventListener||(window.addEventListener=function(e,n,t){e.attachEvent&&e.attachEvent("on"+n,t)}),window.attachEventListener=function(e,n,t,s){e.addEventListener(n,t,s)};var M=window.MediaStream;"undefined"==typeof M&&"undefined"!=typeof webkitMediaStream&&(M=webkitMediaStream),"undefined"==typeof M||"stop"in M.prototype||(M.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})}),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker",document.addEventListener("deviceready",C,!1),C();var U,L={};"undefined"==typeof window.RTCPeerConnection?"undefined"==typeof mozRTCPeerConnection?"undefined"!=typeof webkitRTCPeerConnection&&(U=webkitRTCPeerConnection):U=mozRTCPeerConnection:U=window.RTCPeerConnection;var A=window.RTCSessionDescription||window.mozRTCSessionDescription,D=window.RTCIceCandidate||window.mozRTCIceCandidate,N=window.MediaStreamTrack,V=function(){function e(e,s){var i=t(e);return i.videoCodecNumbers?"vp8"===s&&i.vp8LineNumber===i.videoCodecNumbers[0]?e:"vp9"===s&&i.vp9LineNumber===i.videoCodecNumbers[0]?e:"h264"===s&&i.h264LineNumber===i.videoCodecNumbers[0]?e:(e=n(e,s,i),e):e}function n(e,n,t,s){var i="";if("vp8"===n){if(!t.vp8LineNumber)return e;i=t.vp8LineNumber}if("vp9"===n){if(!t.vp9LineNumber)return e;i=t.vp9LineNumber}if("h264"===n){if(!t.h264LineNumber)return e;i=t.h264LineNumber}var r=t.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",o=[i];return s&&(o=[]),t.videoCodecNumbers.forEach(function(e){e===i||o.push(e)}),r+=o.join(" "),e=e.replace(t.videoCodecNumbersOriginal,r),e}function t(e){var n={};return e.split("\n").forEach(function(e){0===e.indexOf("m=video")&&(n.videoCodecNumbers=[],e.split("SAVPF")[1].split(" ").forEach(function(t){t=t.trim(),t&&t.length&&(n.videoCodecNumbers.push(t),n.videoCodecNumbersOriginal=e)})),-1===e.indexOf("VP8/90000")||n.vp8LineNumber||(n.vp8LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||n.vp9LineNumber||(n.vp9LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||n.h264LineNumber||(n.h264LineNumber=e.replace("a=rtpmap:","").split(" ")[0])}),n}function s(e,n,t){return n?"undefined"!=typeof H&&H?e:(t&&(n.screen?300>n.screen&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),n.screen&&t&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n")),(n.audio||n.video)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),n.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+n.audio+"\r\n")),n.screen?e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n"):n.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.video+"\r\n")),e):e}function i(e,n,t){return r(e,0,-1,n,t)}function r(e,n,t,s,r){for(var o=-1===t?e.length:t,a=n;a<o;++a)if(0===e[a].indexOf(s)&&(!r||-1!==e[a].toLowerCase().indexOf(r.toLowerCase())))return a;return null}function o(e){var n=/a=rtpmap:(\d+) \w+\/\d+/,t=e.match(n);return t&&2===t.length?t[1]:null}function a(e,n){n=n||{};var t,s=n.min,r=n.max,a=e.split("\r\n"),d=i(a,"a=rtpmap","VP8/90000");if(d&&(t=o(a[d])),!t)return e;var c,m=i(a,"a=rtpmap","rtx/90000");if(m&&(c=o(a[m])),!m)return e;var u=i(a,"a=fmtp:"+c.toString());if(null!==u){var p="\r\n";p+="a=fmtp:"+t+" x-google-min-bitrate="+(s||"228")+"; x-google-max-bitrate="+(r||"228"),a[u]=a[u].concat(p),e=a.join("\r\n")}return e}function d(e,n){n=n||{};var t,s=e.split("\r\n"),r=i(s,"a=rtpmap","opus/48000");if(r&&(t=o(s[r])),!t)return e;var a=i(s,"a=fmtp:"+t.toString());if(null===a)return e;var d="";return d+="; stereo="+("undefined"==typeof n.stereo?"1":n.stereo),d+="; sprop-stereo="+("undefined"==typeof n["sprop-stereo"]?"1":n["sprop-stereo"]),"undefined"!=typeof n.maxaveragebitrate&&(d+="; maxaveragebitrate="+(n.maxaveragebitrate||1048576)),"undefined"!=typeof n.maxplaybackrate&&(d+="; maxplaybackrate="+(n.maxplaybackrate||1048576)),"undefined"!=typeof n.cbr&&(d+="; cbr="+("undefined"==typeof n.cbr?"1":n.cbr)),"undefined"!=typeof n.useinbandfec&&(d+="; useinbandfec="+n.useinbandfec),"undefined"!=typeof n.usedtx&&(d+="; usedtx="+n.usedtx),"undefined"!=typeof n.maxptime&&(d+="\r\na=maxptime:"+n.maxptime),s[a]=s[a].concat(d),e=s.join("\r\n"),e}return{removeVPX:function(e){var s=t(e);return e=n(e,"vp9",s,!0),e=n(e,"vp8",s,!0),e},disableNACK:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=e.replace("a=rtcp-fb:126 nack\r\n",""),e=e.replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n"),e=e.replace("a=rtcp-fb:97 nack\r\n",""),e=e.replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n"),e},prioritize:function(e,n){if(n&&n.getSenders&&n.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";n.getSenders().forEach(function(n){for(var t=n.getParameters(),s=0;s<t.codecs.length;s++)if(t.codecs[s].mimeType==e){t.codecs.unshift(t.codecs.splice(s,1));break}n.setParameters(t)})}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,n,t){return s(e,n,t)},setVideoBitrates:function(e,n){return a(e,n)},setOpusAttributes:function(e,n){return d(e,n)},preferVP9:function(n){return e(n,"vp9")},preferCodec:e,forceStereoAudio:function(e){for(var n=e.split("\r\n"),t=null,s=0;s<n.length;s++)if(-1!==n[s].search("opus/48000")){var r=extractSdp(n[s],/:(\d+) opus\/48000/i);break}for(var s=0;s<n.length;s++)if(-1!==n[s].search("a=fmtp")){var o=extractSdp(n[s],/a=fmtp:(\d+)/);if(o===r){t=s;break}}return null===t?e:(n[t]=n[t].concat("; stereo=1; sprop-stereo=1"),e=n.join("\r\n"),e)}}}();window.BandwidthHandler=V;var B=function(){return{processCandidates:function(e,n){var t=n.candidate,s=e.candidates,i=s.stun,r=s.turn;if((p(s.reflexive)||(i=s.reflexive),p(s.relay)||(r=s.relay),s.host||!t.match(/typ host/g))&&(r||!t.match(/typ relay/g))&&(i||!t.match(/typ srflx/g))){var o=e.iceProtocols;if(o.udp||!t.match(/ udp /g))return o.tcp||!t.match(/ tcp /g)?(e.enableLogs&&console.debug("Your candidate pairs:",t),{candidate:t,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex}):void 0}}}}(),F=function(){return{getIceServers:function(){return svConfigs.iceServers}}}();window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var n=this.streams[e];if(n){n=n.stream;var t=n.currentUserMediaRequestOptions;this.queueRequests.indexOf(t)&&(delete this.queueRequests[this.queueRequests.indexOf(t)],this.queueRequests=m(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}};var W=function(){function e(e){return e?"string"==typeof e||"undefined"==typeof e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0:void 0}function n(n,s,r){function o(){if(r.streamEvents[n.streamid].mediaElement){var s=r.streamEvents[n.streamid].mediaElement;s.volume=0,t(200,5,function(){try{s.volume+=.2}catch(n){s.volume=1}})}}if(n&&n.addEventListener){if("undefined"==typeof s||!0==s){var a="ended";"oninactive"in n&&(a="inactive"),n.addEventListener(a,function(){W.onSyncNeeded(this.streamid,a)},!1)}n.mute=function(t,o){t=e(t),"undefined"!=typeof o&&(s=o),("undefined"==typeof t||"audio"==t)&&v(n,"audio").forEach(function(e){e.enabled=!1,r.streamEvents[n.streamid].isAudioMuted=!0}),("undefined"==typeof t||"video"==t)&&v(n,"video").forEach(function(e){e.enabled=!1}),("undefined"==typeof s||!0==s)&&W.onSyncNeeded(n.streamid,"mute",t),r.streamEvents[n.streamid].muteType=t||"both",i(n,"mute",t)},n.unmute=function(t,a){t=e(t),"undefined"!=typeof a&&(s=a),o(),("undefined"==typeof t||"audio"==t)&&v(n,"audio").forEach(function(e){e.enabled=!0,r.streamEvents[n.streamid].isAudioMuted=!1}),("undefined"==typeof t||"video"==t)&&(v(n,"video").forEach(function(e){e.enabled=!0}),"undefined"!=typeof t&&"video"==t&&r.streamEvents[n.streamid].isAudioMuted&&function e(t){t||(t=0),t++,100>t&&r.streamEvents[n.streamid].isAudioMuted&&(n.mute("audio"),setTimeout(function(){e(t)},50))}()),("undefined"==typeof s||!0==s)&&W.onSyncNeeded(n.streamid,"unmute",t),r.streamEvents[n.streamid].unmuteType=t||"both",i(n,"unmute",t)}}}function t(e,n,s,i){i=(i||0)+1;i>=n||setTimeout(function(){s(),t(e,n,s,i)},e)}return{setHandlers:n,onSyncNeeded:function(){}}}();window.addEventListener("message",function(e){e.origin!=window.location.origin||E(e.data)});var G,q,j="screen",H="undefined"!=typeof window.InstallTrigger,z=!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),_=!!window.chrome&&!z,K={send:function(e){function n(e,r){var a={type:"text",uuid:m,sendingTime:u};e&&(r=e,a.packets=parseInt(r.length/o)),r.length>o?a.message=r.slice(0,o):(a.message=r,a.last=!0,a.isobject=c),s.send(a,i),d=r.slice(a.message.length),d.length&&setTimeout(function(){n(null,d)},t.chunkInterval||100)}var t=e.connection,s=e.channel,i=e.remoteUserId,r=e.text,o=t.chunkSize||1e3,d="",c=!1;l(r)||(c=!0,r=JSON.stringify(r));var m=a(),u=new Date().getTime();n(r)}},J=function(){return{handle:function(e){function n(e,n){if(-1!==e.position){var t=+e.position.toFixed(2).split(".")[1]||100;n.innerHTML=t+"%"}}var t={};e.onFileStart=function(n){var s=document.createElement("div");return s.title=n.name,s.innerHTML="<label>0%</label> <progress></progress>",n.remoteUserId&&(s.innerHTML+=" (Sharing with:"+n.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(s,e.filesContainer.firstChild),n.remoteUserId?void(!t[n.uuid]&&(t[n.uuid]={}),t[n.uuid][n.remoteUserId]={div:s,progress:s.querySelector("progress"),label:s.querySelector("label")},t[n.uuid][n.remoteUserId].progress.max=n.maxChunks):(t[n.uuid]={div:s,progress:s.querySelector("progress"),label:s.querySelector("label")},void(t[n.uuid].progress.max=n.maxChunks))},e.onFileProgress=function(e){var s=t[e.uuid];!s||e.remoteUserId&&(s=t[e.uuid][e.remoteUserId],!s)||(s.progress.value=e.currentPosition||e.maxChunks||s.progress.max,n(s.progress,s.label))},e.onFileEnd=function(e){var n=t[e.uuid];if(!n)return void console.error("No such progress-helper element exist.",e);if(!(e.remoteUserId&&(n=t[e.uuid][e.remoteUserId],!n))){var s=n.div;s.innerHTML=-1==e.type.indexOf("image")?"<a href=\""+e.url+"\" download=\""+e.name+"\">Download <strong style=\"color:red;\">"+e.name+"</strong> </a><br /><iframe src=\""+e.url+"\" title=\""+e.name+"\" style=\"width: 80%;border: 0;height: inherit;margin-top:1em;\"></iframe>":"<a href=\""+e.url+"\" download=\""+e.name+"\">Download <strong style=\"color:red;\">"+e.name+"</strong> </a><br /><img src=\""+e.url+"\" title=\""+e.name+"\" style=\"max-width: 80%;\">"}}}}}(),X=function(){return{handle:function(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(n,t){var s=document.createElement("script");s.type="text/javascript";var i=encodeURIComponent(n),r="method"+e.token();window[r]=function(e){return e.data&&e.data.translations[0]&&t?void t(e.data.translations[0].translatedText):e.error&&"Daily Limit Exceeded"===e.error.message?void console.error("Text translation failed. Error message: \"Daily Limit Exceeded.\""):e.error?void console.error(e.error.message):void console.error(e)};var o="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+r+"&q="+i;s.src=o,document.getElementsByTagName("head")[0].appendChild(s)},getListOfLanguages:function(n){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(t.readyState==XMLHttpRequest.DONE){var e=JSON.parse(t.responseText);if(e&&e.data&&e.data.languages)return void n(e.data.languages);if(e.error&&"Daily Limit Exceeded"===e.error.message)return void console.error("Text translation failed. Error message: \"Daily Limit Exceeded.\"");if(e.error)return void console.error(e.error.message);console.error(e)}};var s="https://www.googleapis.com/language/translate/v2/languages?key="+e.googKey+"&target=en";t.open("GET",s,!0),t.send(null)}}}}}();(function(i){function m(e){if(i.socketAutoReConnect=!0,i.socket)return void(e&&e(i.socket));if("undefined"==typeof t)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else if("undefined"!=typeof PubNubConnection)window.SocketConnection=PubNubConnection;else throw"SocketConnection.js seems missed.";new t(i,function(){e&&e(i.socket)})}function p(e,n){i.socket.emit("join-room",{sessionid:i.sessionid,session:i.session,mediaConstraints:i.mediaConstraints,sdpConstraints:i.sdpConstraints,streams:S(),extra:i.extra,password:"undefined"!=typeof i.password&&"object"!=typeof i.password?i.password:""},function(t,s){if(!0===t){if(i.enableLogs&&console.log("isRoomJoined: ",t," roomid: ",i.sessionid),!!i.peers[i.sessionid])return;w.onNegotiationNeeded(e)}!1===t&&(i.enableLogs&&console.warn("isRoomJoined: ",s," roomid: ",i.sessionid),!1),n(t,i.sessionid,s)})}function l(e){i.enableLogs&&console.log("Sending open-room signal to socket.io"),i.waitingForLocalMedia=!1,i.socket.emit("open-room",{sessionid:i.sessionid,session:i.session,mediaConstraints:i.mediaConstraints,sdpConstraints:i.sdpConstraints,streams:S(),extra:i.extra,identifier:i.publicRoomIdentifier,password:"undefined"!=typeof i.password&&"object"!=typeof i.password?i.password:""},function(n,t){!0===n&&(i.enableLogs&&console.log("isRoomOpened: ",n," roomid: ",i.sessionid),e(n,i.sessionid)),!1===n&&(i.enableLogs&&console.warn("isRoomOpened: ",t," roomid: ",i.sessionid),e(n,i.sessionid,t))})}function S(){try{return i.streamEvents.selectAll("local").map(function(e){return{streamid:e.streamid,tracks:e.stream.getTracks().length}})}catch(n){return[]}}function C(e,n){if(i.dontCaptureUserMedia||e.isDataOnly)return void n();var t={};e.localPeerSdpConstraints.OfferToReceiveAudio&&(t.audio=i.mediaConstraints.audio),e.localPeerSdpConstraints.OfferToReceiveVideo&&(t.video=i.mediaConstraints.video);var s=e.session||i.session;return s.oneway&&"two-way"!==s.audio&&"two-way"!==s.video&&"two-way"!==s.screen?void n():void(s.oneway&&s.audio&&"two-way"===s.audio&&(s={audio:!0}),(s.audio||s.video||s.screen)&&(s.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(i)}).then(function(e){e.isScreen=!0,w.onGettingLocalMedia(e),(s.audio||s.video)&&!f(i)?i.invokeGetUserMedia(null,n):n(e)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.getScreenConstraints(function(e,t){i.invokeGetUserMedia({audio:!!f(i)&&g(t),video:t,isScreen:!0},(s.audio||s.video)&&!f(i)?i.invokeGetUserMedia(null,n):n)}):(s.audio||s.video)&&i.invokeGetUserMedia(null,n,s)))}function b(e,n){return e?void(n.audio&&v(e,"audio").forEach(function(e){e.applyConstraints(n.audio)}),n.video&&v(e,"video").forEach(function(e){e.applyConstraints(n.video)})):void(!i.enableLogs||console.error("No stream to applyConstraints."))}function k(e,n,t){return n?void w.replaceTrack(e,n,t):void i.peers.getAllParticipants().forEach(function(n){w.replaceTrack(e,n,t)})}n=n||{useDefaultDevices:!0},i.channel=i.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var w=new s(i),E={};w.onGettingLocalMedia=function(e,n){if(n=n||function(){},E[e.streamid])return void n();E[e.streamid]=!0;try{e.type="local"}catch(n){}i.setStreamEndHandler(e),d(e,function(t){t.id=e.streamid,t.muted=!0,t.volume=0,-1===i.attachStreams.indexOf(e)&&i.attachStreams.push(e),"undefined"!=typeof W&&W.setHandlers(e,!0,i),i.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:t,userid:i.userid,extra:i.extra,streamid:e.streamid,isAudioMuted:!0};try{r(i,i.streamEvents[e.streamid]),o(i,i.streamEvents[e.streamid]),i.onstream(i.streamEvents[e.streamid])}catch(n){}n()},i)},w.onGettingRemoteMedia=function(e,n){try{e.type="remote"}catch(n){}i.setStreamEndHandler(e,"remote-stream"),d(e,function(t){t.id=e.streamid,"undefined"!=typeof W&&W.setHandlers(e,!1,i),i.streamEvents[e.streamid]={stream:e,type:"remote",userid:n,extra:i.peers[n]?i.peers[n].extra:{},mediaElement:t,streamid:e.streamid},o(i,i.streamEvents[e.streamid]),i.onstream(i.streamEvents[e.streamid])},i)},w.onRemovingRemoteMedia=function(e,n){var t=i.streamEvents[e.streamid];t||(t={stream:e,type:"remote",userid:n,extra:i.peers[n]?i.peers[n].extra:{},streamid:e.streamid,mediaElement:i.streamEvents[e.streamid]?i.streamEvents[e.streamid].mediaElement:null}),i.peersBackup[t.userid]&&(t.extra=i.peersBackup[t.userid].extra),i.onstreamended(t),delete i.streamEvents[e.streamid]},w.onNegotiationNeeded=function(e,n,t){t=t||function(){},n=n||e.remoteUserId,e=e||"";var s={remoteUserId:n,message:e,sender:i.userid};e.remoteUserId&&e.message&&e.sender&&(s=e),m(function(){i.socket.emit(i.socketMessageEvent,s,t)})},w.onUserLeft=function(e){i.deletePeer(e)},w.disconnectWith=function(e,n){i.socket&&i.socket.emit("disconnect-with",e,n||function(){}),i.deletePeer(e)},i.socketOptions={transport:"polling"},i.openOrJoin=function(e,n){n=n||function(){},i.checkPresence(e,function(e,t){if(e){i.sessionid=t;var s=!1,r=!1,o=!!i.session.oneway,a=u(i.session);r={OfferToReceiveAudio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i.sdpConstraints.mandatory.OfferToReceiveVideo},s={OfferToReceiveAudio:o?!!i.session.audio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:o?!!i.session.video||!!i.session.screen:i.sdpConstraints.mandatory.OfferToReceiveVideo};var d={remoteUserId:i.sessionid,message:{newParticipationRequest:!0,isOneWay:o,isDataOnly:a,localPeerSdpConstraints:s,remotePeerSdpConstraints:r},sender:i.userid};return void C(d.message,function(){p(d,n)})}return i.waitingForLocalMedia=!0,i.isInitiator=!0,i.sessionid=t||i.sessionid,u(i.session)?void l(n):void i.captureUserMedia(function(){l(n)})})},i.waitingForLocalMedia=!1,i.open=function(e,n){n=n||function(){},i.waitingForLocalMedia=!0,i.isInitiator=!0,i.sessionid=e||i.sessionid,m(function(){return u(i.session)?void l(n):void i.captureUserMedia(function(){l(n)})})},i.peersBackup={},i.deletePeer=function(e){if(e&&i.peers[e]){var n={userid:e,extra:i.peers[e]?i.peers[e].extra:{}};if(i.peersBackup[n.userid]&&(n.extra=i.peersBackup[n.userid].extra),i.onleave(n),!!i.peers[e]){i.peers[e].streams.forEach(function(e){e.stop()});var t=i.peers[e].peer;if(t&&"closed"!==t.iceConnectionState)try{t.close()}catch(n){}i.peers[e]&&(i.peers[e].peer=null,delete i.peers[e])}}},i.rejoin=function(e){if(!i.isInitiator&&e&&Object.keys(e).length){var n={};i.peers[e.remoteUserId]&&(n=i.peers[e.remoteUserId].extra,i.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(i.join(e.remoteUserId),i.onReConnecting({userid:e.remoteUserId,extra:n}))}},i.join=function(e,n){i.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||i.sessionid,i.sessionid+="";var t=!1,s=!1,r=!1,o=!1;if(e&&e.session||!e||"string"==typeof e){var a=e?e.session||i.session:i.session;r=!!a.oneway,o=u(a),s={OfferToReceiveAudio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i.sdpConstraints.mandatory.OfferToReceiveVideo},t={OfferToReceiveAudio:r?!!i.session.audio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r?!!i.session.video||!!i.session.screen:i.sdpConstraints.mandatory.OfferToReceiveVideo}}n=n||{};var d=function(){};"function"==typeof n&&(d=n,n={}),"undefined"!=typeof n.localPeerSdpConstraints&&(t=n.localPeerSdpConstraints),"undefined"!=typeof n.remotePeerSdpConstraints&&(s=n.remotePeerSdpConstraints),"undefined"!=typeof n.isOneWay&&(r=n.isOneWay),"undefined"!=typeof n.isDataOnly&&(o=n.isDataOnly);var c={remoteUserId:i.sessionid,message:{newParticipationRequest:!0,isOneWay:r,isDataOnly:o,localPeerSdpConstraints:t,remotePeerSdpConstraints:s},sender:i.userid};return C(c.message,function(){m(function(){p(c,d)})}),c},i.publicRoomIdentifier="",i.getUserMedia=i.captureUserMedia=function(e,n){e=e||function(){};var t=n||i.session;return i.dontCaptureUserMedia||u(t)?void e():void((t.audio||t.video||t.screen)&&(t.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(i)}).then(function(r){if(r.isScreen=!0,w.onGettingLocalMedia(r),(t.audio||t.video)&&!f(i)){var o={};for(var a in t)"screen"!=a&&(o[a]=t[a]);return void i.invokeGetUserMedia(n,e,o)}e(r)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.getScreenConstraints(function(s,r){if(s)throw s;i.invokeGetUserMedia({audio:!!f(i)&&g(r),video:r,isScreen:!0},function(r){if((t.audio||t.video)&&!f(i)){var o={};for(var a in t)"screen"!=a&&(o[a]=t[a]);return void i.invokeGetUserMedia(n,e,o)}e(r)})}):(t.audio||t.video)&&i.invokeGetUserMedia(n,e,t)))},i.onbeforeunload=function(e,n){i.closeBeforeUnload&&(i.peers.getAllParticipants().forEach(function(e){w.onNegotiationNeeded({userLeft:!0},e),i.peers[e]&&i.peers[e].peer&&i.peers[e].peer.close(),delete i.peers[e]}),!n&&i.closeSocket(),i.isInitiator=!1)},window.ignoreBeforeUnload?i.closeBeforeUnload=!1:(i.closeBeforeUnload=!0,window.addEventListener("beforeunload",i.onbeforeunload,!1)),i.userid=a(),i.changeUserId=function(e,n){n=n||function(){},i.userid=e||a(),i.socket.emit("changed-uuid",i.userid,n)},i.extra={},i.attachStreams=[],i.session={audio:!0,video:!0},i.enableFileSharing=!1,i.bandwidth={screen:!1,audio:!1,video:!1},i.codecs={audio:"opus",video:"VP9"},i.processSdp=function(e){return h()?e:"Safari"===DetectRTC.browser.name?e:("VP8"===i.codecs.video.toUpperCase()&&(e=V.preferCodec(e,"vp8")),"VP9"===i.codecs.video.toUpperCase()&&(e=V.preferCodec(e,"vp9")),"H264"===i.codecs.video.toUpperCase()&&(e=V.preferCodec(e,"h264")),"G722"===i.codecs.audio&&(e=V.removeNonG722(e)),"Firefox"===DetectRTC.browser.name)?e:((i.bandwidth.video||i.bandwidth.screen)&&(e=V.setApplicationSpecificBandwidth(e,i.bandwidth,!!i.session.screen)),i.bandwidth.video&&(e=V.setVideoBitrates(e,{min:1024*(8*i.bandwidth.video),max:1024*(8*i.bandwidth.video)})),i.bandwidth.audio&&(e=V.setOpusAttributes(e,{maxaveragebitrate:1024*(8*i.bandwidth.audio),maxplaybackrate:1024*(8*i.bandwidth.audio),stereo:1,maxptime:3})),e)},"undefined"!=typeof V&&(i.BandwidthHandler=i.CodecsHandler=V),i.mediaConstraints={audio:{mandatory:{},optional:i.bandwidth.audio?[{bandwidth:1024*(8*i.bandwidth.audio)||1048576}]:[]},video:{mandatory:{},optional:i.bandwidth.video?[{bandwidth:1024*(8*i.bandwidth.video)||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},"Firefox"===DetectRTC.browser.name&&(i.mediaConstraints={audio:!0,video:!0}),n.useDefaultDevices||DetectRTC.isMobileDevice||DetectRTC.load(function(){var e,n;if(DetectRTC.MediaDevices.forEach(function(t){"audioinput"===t.kind&&!1!==i.mediaConstraints.audio&&(e=t),"videoinput"===t.kind&&!1!==i.mediaConstraints.video&&(n=t)}),e){if("Firefox"===DetectRTC.browser.name)return void(!0===i.mediaConstraints.audio?i.mediaConstraints.audio={deviceId:e.id}:i.mediaConstraints.audio.deviceId=e.id);!0==i.mediaConstraints.audio&&(i.mediaConstraints.audio={mandatory:{},optional:[]}),i.mediaConstraints.audio.optional||(i.mediaConstraints.audio.optional=[]);var t=[{sourceId:e.id}];i.mediaConstraints.audio.optional=t.concat(i.mediaConstraints.audio.optional)}if(n){if("Firefox"===DetectRTC.browser.name)return void(!0===i.mediaConstraints.video?i.mediaConstraints.video={deviceId:n.id}:i.mediaConstraints.video.deviceId=n.id);!0==i.mediaConstraints.video&&(i.mediaConstraints.video={mandatory:{},optional:[]}),i.mediaConstraints.video.optional||(i.mediaConstraints.video.optional=[]);var t=[{sourceId:n.id}];i.mediaConstraints.video.optional=t.concat(i.mediaConstraints.video.optional)}}),i.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},i.sdpSemantics=null,i.iceCandidatePoolSize=null,i.bundlePolicy=null,i.rtcpMuxPolicy=null,i.iceTransportPolicy=null,i.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},i.iceServers=F.getIceServers(i),i.candidates={host:!0,stun:!0,turn:!0},i.iceProtocols={tcp:!0,udp:!0},i.onopen=function(e){!i.enableLogs||console.info("Data connection has been opened between you & ",e.userid)},i.onclose=function(e){!i.enableLogs||console.warn("Data connection has been closed between you & ",e.userid)},i.onerror=function(e){!i.enableLogs||console.error(e.userid,"data-error",e)},i.onmessage=function(e){!i.enableLogs||console.debug("data-message",e.userid,e.data)},i.send=function(e,n){i.peers.send(e,n)},i.close=i.disconnect=i.leave=function(){i.onbeforeunload(!1,!0)},i.closeEntireSession=function(e){e=e||function(){},i.socket.emit("close-entire-session",function n(){return i.getAllParticipants().length?void setTimeout(n,100):void(i.onEntireSessionClosed({sessionid:i.sessionid,userid:i.userid,extra:i.extra}),i.changeUserId(null,function(){i.close(),e()}))})},i.onEntireSessionClosed=function(e){i.enableLogs&&console.info("Entire session is closed: ",e.sessionid,e.extra)},i.onstream=function(n){var e=i.videosContainer;e.insertBefore(n.mediaElement,e.firstChild);var t=n.mediaElement.play();return"undefined"==typeof t?void setTimeout(function(){n.mediaElement.play()},2e3):void t.catch(function(){}).then(function(){setTimeout(function(){n.mediaElement.play()},2e3)})},i.onstreamended=function(n){n.mediaElement||(n.mediaElement=document.getElementById(n.streamid)),n.mediaElement&&n.mediaElement.parentNode&&n.mediaElement.parentNode.removeChild(n.mediaElement)},i.direction="many-to-many",i.removeStream=function(e,n){var t;return i.attachStreams.forEach(function(n){n.id===e&&(t=n)}),t?void(i.peers.getAllParticipants().forEach(function(e){if(!(n&&e!==n)){var s=i.peers[e];try{s.peer.removeStream(t)}catch(n){}}}),i.renegotiate()):void console.warn("No such stream exist.",e)},i.addStream=function(e,n){function t(t){e.streamCallback&&e.streamCallback(t),i.renegotiate(n)}return e.getTracks?(-1===i.attachStreams.indexOf(e)&&(!e.streamid&&(e.streamid=e.id),i.attachStreams.push(e)),void i.renegotiate(n)):u(e)?void i.renegotiate(n):void((e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(i)}).then(function(n){n.isScreen=!0,w.onGettingLocalMedia(n),(e.audio||e.video)&&!f(i)?i.invokeGetUserMedia(null,function(e){t(e)}):t(n)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.getScreenConstraints(function(n,s){return n?"PermissionDeniedError"===n?(e.streamCallback&&e.streamCallback(null),void(i.enableLogs&&console.error("User rejected to share his screen."))):alert(n):void i.invokeGetUserMedia({audio:!!f(i)&&g(s),video:s,isScreen:!0},function(n){(e.audio||e.video)&&!f(i)?i.invokeGetUserMedia(null,function(e){t(e)}):t(n)})}):(e.audio||e.video)&&i.invokeGetUserMedia(null,t)))},i.invokeGetUserMedia=function(e,n,t){t||(t=i.session),e||(e=i.mediaConstraints),y({onGettingLocalMedia:function(t){var s=e.video;s&&(s.mediaSource||s.mozMediaSource?t.isScreen=!0:s.mandatory&&s.mandatory.chromeMediaSource&&(t.isScreen=!0)),t.isScreen||(t.isVideo=!!v(t,"video").length,t.isAudio=!t.isVideo&&v(t,"audio").length),w.onGettingLocalMedia(t,function(){"function"==typeof n&&n(t)})},onLocalMediaError:function(e,n){w.onLocalMediaError(e,n)},localMediaConstraints:e||{audio:!!t.audio&&e.audio,video:!!t.video&&e.video}})},i.applyConstraints=function(e,n){if(!N||!N.prototype.applyConstraints)return void alert("track.applyConstraints is NOT supported in your browser.");if(n){var t;return i.streamEvents[n]&&(t=i.streamEvents[n].stream),void b(t,e)}i.attachStreams.forEach(function(n){b(n,e)})},i.replaceTrack=function(e,n,t){function s(s){i.replaceTrack(s,n,t||e.video||e.screen)}if(e=e||{},!U.prototype.getSenders)return void i.addStream(e);if(e instanceof N)return void k(e,n,t);if(e instanceof M)return v(e,"video").length&&k(v(e,"video")[0],n,!0),void(v(e,"audio").length&&k(v(e,"audio")[0],n,!1));if(u(e)){throw"connection.replaceTrack requires audio and/or video and/or screen."}(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(i)}).then(function(n){n.isScreen=!0,w.onGettingLocalMedia(n),(e.audio||e.video)&&!f(i)?i.invokeGetUserMedia(null,s):s(n)},function(){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.getScreenConstraints(function(n,t){return n?alert(n):void i.invokeGetUserMedia({audio:!!f(i)&&g(t),video:t,isScreen:!0},(e.audio||e.video)&&!f(i)?i.invokeGetUserMedia(null,s):s)}):(e.audio||e.video)&&i.invokeGetUserMedia(null,s))},i.resetTrack=function(e,n){e||(e=i.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach(function(e){var t=i.peers[e].peer;("undefined"==typeof n||!0===n)&&t.lastVideoTrack&&i.replaceTrack(t.lastVideoTrack,e,!0),("undefined"==typeof n||!1===n)&&t.lastAudioTrack&&i.replaceTrack(t.lastAudioTrack,e,!1)})},i.renegotiate=function(e){return e?void w.renegotiatePeer(e):void i.peers.getAllParticipants().forEach(function(e){w.renegotiatePeer(e)})},i.setStreamEndHandler=function(e,n){if(e&&e.addEventListener&&(n=!!n,!e.alreadySetEndHandler)){e.alreadySetEndHandler=!0;var t="ended";"oninactive"in e&&(t="inactive"),e.addEventListener(t,function(){if(e.idInstance&&currentUserMediaRequest.remove(e.idInstance),!n){var t=[];i.attachStreams.forEach(function(n){n.id!=e.id&&t.push(n)}),i.attachStreams=t}var s=i.streamEvents[e.streamid];if(s||(s={stream:e,streamid:e.streamid,type:n?"remote":"local",userid:i.userid,extra:i.extra,mediaElement:i.streamEvents[e.streamid]?i.streamEvents[e.streamid].mediaElement:null}),n&&i.peers[s.userid]){var r=i.peers[s.userid].peer,t=[];r.getRemoteStreams().forEach(function(n){n.id!=e.id&&t.push(n)}),i.peers[s.userid].streams=t}s.userid===i.userid&&"remote"===s.type||(i.peersBackup[s.userid]&&(s.extra=i.peersBackup[s.userid].extra),i.onstreamended(s),delete i.streamEvents[e.streamid])},!1)}},i.onMediaError=function(e,n){!i.enableLogs||console.error(e,n)},i.autoCloseEntireSession=!1,i.filesContainer=i.videosContainer=document.body||document.documentElement,i.isInitiator=!1,i.shareFile=w.shareFile,"undefined"!=typeof J&&J.handle(i),"undefined"!=typeof X&&X.handle(i),i.token=a,i.onNewParticipant=function(e,n){i.acceptParticipationRequest(e,n)},i.acceptParticipationRequest=function(e,n){n.successCallback&&(n.successCallback(),delete n.successCallback),w.createNewPeer(e,n)},"undefined"!=typeof W&&(i.StreamsHandler=W),i.onleave=function(){},i.invokeSelectFileDialog=function(e){var n=new FileSelector;n.accept="*.*",n.selectSingleFile(e)},i.onmute=function(n){if(n&&n.mediaElement)if("both"===n.muteType||"video"===n.muteType){n.mediaElement.src=null;var e=n.mediaElement.pause();"undefined"==typeof e?n.mediaElement.poster=n.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png":e.then(function(){n.mediaElement.poster=n.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"})}else"audio"===n.muteType&&(n.mediaElement.muted=!0)},i.onunmute=function(n){n&&n.mediaElement&&n.stream&&("both"===n.unmuteType||"video"===n.unmuteType?(n.mediaElement.poster=null,n.mediaElement.srcObject=n.stream,n.mediaElement.play()):"audio"===n.unmuteType&&(n.mediaElement.muted=!1))},i.onExtraDataUpdated=function(e){e.status="online",i.onUserStatusChanged(e,!0)},i.getAllParticipants=function(e){return i.peers.getAllParticipants(e)},"undefined"!=typeof W&&(W.onSyncNeeded=function(e,n,t){i.peers.getAllParticipants().forEach(function(s){w.onNegotiationNeeded({streamid:e,action:n,streamSyncNeeded:!0,type:t||"both"},s)})}),i.connectSocket=function(e){m(e)},i.closeSocket=function(){try{io.sockets={}}catch(n){}i.socket&&("function"==typeof i.socket.disconnect&&i.socket.disconnect(),"function"==typeof i.socket.resetProps&&i.socket.resetProps(),i.socket=null)},i.getSocket=function(e){return!e&&i.enableLogs&&console.warn("getSocket.callback paramter is required."),e=e||function(){},i.socket?e(i.socket):m(function(){e(i.socket)}),i.socket},i.getRemoteStreams=w.getRemoteStreams;var T=["selectFirst","selectAll","forEach"];if(i.streamEvents={selectFirst:function(e){return i.streamEvents.selectAll(e)[0]},selectAll:function(e){e||(e={local:!0,remote:!0,isScreen:!0,isAudio:!0,isVideo:!0}),"local"==e&&(e={local:!0}),"remote"==e&&(e={remote:!0}),"screen"==e&&(e={isScreen:!0}),"audio"==e&&(e={isAudio:!0}),"video"==e&&(e={isVideo:!0});var n=[];return Object.keys(i.streamEvents).forEach(function(t){var s=i.streamEvents[t];if(-1===T.indexOf(t)){var r=!0;e.local&&"local"===s.type&&(r=!1),e.remote&&"remote"===s.type&&(r=!1),e.isScreen&&s.stream.isScreen&&(r=!1),e.isVideo&&s.stream.isVideo&&(r=!1),e.isAudio&&s.stream.isAudio&&(r=!1),e.userid&&s.userid===e.userid&&(r=!1),!1==r&&n.push(s)}}),n}},i.socketURL="/",i.socketMessageEvent="RTCMultiConnection-Message",i.socketCustomEvent="RTCMultiConnection-Custom-Message",i.DetectRTC=DetectRTC,i.setCustomSocketEvent=function(e){e&&(i.socketCustomEvent=e),i.socket&&i.socket.emit("set-custom-socket-event-listener",i.socketCustomEvent)},i.getNumberOfBroadcastViewers=function(e,n){i.socket&&e&&n&&i.socket.emit("get-number-of-users-in-specific-broadcast",e,n)},i.onNumberOfBroadcastViewersUpdated=function(e){i.enableLogs&&i.isInitiator&&console.info("Number of broadcast (",e.broadcastId,") viewers",e.numberOfBroadcastViewers)},i.onUserStatusChanged=function(e,n){!i.enableLogs||n||console.info(e.userid,e.status)},i.getUserMediaHandler=y,i.multiPeersHandler=w,i.enableLogs=!0,i.setCustomSocketHandler=function(e){"undefined"!=typeof t&&(t=e)},i.chunkSize=40000,i.maxParticipantsAllowed=1e3,i.disconnectWith=w.disconnectWith,i.checkPresence=function(e,n){return e=e||i.sessionid,"SSEConnection"===t.name?void SSEConnection.checkPresence(e,function(e,t,s){return i.socket?void n(e,t):(e||(i.userid=t),void i.connectSocket(function(){n(e,t,s)}))}):i.socket?void i.socket.emit("check-presence",e+"",function(e,t,s){i.enableLogs&&console.log("checkPresence.isRoomExist: ",e," roomid: ",t),n(e,t,s)}):void i.connectSocket(function(){i.checkPresence(e,n)})},i.onReadyForOffer=function(e,n){i.multiPeersHandler.createNewPeer(e,n)},i.setUserPreferences=function(e){return i.dontAttachStream&&(e.dontAttachLocalStream=!0),i.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},i.updateExtraData=function(){i.socket.emit("extra-data-updated",i.extra)},i.enableScalableBroadcast=!1,i.maxRelayLimitPerUser=3,i.dontCaptureUserMedia=!1,i.dontAttachStream=!1,i.dontGetRemoteStream=!1,i.onReConnecting=function(e){i.enableLogs&&console.info("ReConnecting with",e.userid,"...")},i.beforeAddingStream=function(e){return e},i.beforeRemovingStream=function(e){return e},"undefined"!=typeof x&&(i.checkIfChromeExtensionAvailable=x),"undefined"!=typeof isFirefoxExtensionAvailable&&(i.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable),"undefined"!=typeof P&&(i.getChromeExtensionStatus=P),i.getScreenConstraints=function(e,n){f(i,n)&&(n=!0),O(function(n,t){n||(t=i.modifyScreenConstraints(t),e(n,t))},n)},i.modifyScreenConstraints=function(e){return e},i.onPeerStateChanged=function(e){i.enableLogs&&-1!==e.iceConnectionState.search(/closed|failed/gi)&&console.error("Peer connection is closed between you & ",e.userid,e.extra,"state:",e.iceConnectionState)},i.isOnline=!0,c("online",function(){i.isOnline=!0}),c("offline",function(){i.isOnline=!1}),i.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(i.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),i.isLowBandwidth)){if(i.bandwidth={audio:!1,video:!1,screen:!1},i.mediaConstraints.audio&&i.mediaConstraints.audio.optional&&i.mediaConstraints.audio.optional.length){var R=[];i.mediaConstraints.audio.optional.forEach(function(e){"undefined"==typeof e.bandwidth&&R.push(e)}),i.mediaConstraints.audio.optional=R}if(i.mediaConstraints.video&&i.mediaConstraints.video.optional&&i.mediaConstraints.video.optional.length){var R=[];i.mediaConstraints.video.optional.forEach(function(e){"undefined"==typeof e.bandwidth&&R.push(e)}),i.mediaConstraints.video.optional=R}}i.getExtraData=function(e,n){if(!e)throw"remoteUserId is required.";return"function"==typeof n?void i.socket.emit("get-remote-user-extra-data",e,function(e,t,s){n(e,t,s)}):i.peers[e]?i.peers[e].extra:i.peersBackup[e]?i.peersBackup[e].extra:{}},!n.autoOpenOrJoin||i.openOrJoin(i.sessionid),i.onUserIdAlreadyTaken=function(e){i.close(),i.closeSocket(),i.isInitiator=!1,i.userid=i.token(),i.join(i.sessionid),i.enableLogs&&console.warn("Userid already taken.",e,"Your new userid:",i.userid)},i.trickleIce=!0,i.version="3.6.8",i.onSettingLocalDescription=function(e){i.enableLogs&&console.info("Set local description for remote user",e.userid)},i.resetScreen=function(){G=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},i.autoCreateMediaElement=!0,i.password=null,i.setPassword=function(e,n){n=n||function(){},i.socket?i.socket.emit("set-password",e,n):(i.password=e,n(!0,i.sessionid,null))},i.onSocketDisconnect=function(){i.enableLogs&&console.warn("socket.io connection is closed")},i.onSocketError=function(){i.enableLogs&&console.warn("socket.io connection is failed")},i.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}})(this)};"undefined"!=typeof module&&(module.exports=exports=RTCMultiConnection),"function"==typeof define&&define.amd&&define("RTCMultiConnection",[],function(){return RTCMultiConnection});